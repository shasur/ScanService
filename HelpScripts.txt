# project_management.ps1

# Git commands
function Git-Commands {
    # Initialize a new Git repository (if not already initialized)
    git init

    # Add all files to staging
    git add .

    # Commit changes
    $commitMessage = Read-Host "Enter commit message"
    git commit -m "$commitMessage"

    # Push to remote repository (assuming 'main' branch and 'origin' remote)
    # Uncomment the next line if you have a remote repository set up
    # git push origin main
}

# Docker commands
function Docker-Commands {
    # Build Docker image
    docker build -t scanner-service:1.0.0 .

    # List images to verify the build
    docker images scanner-service:1.0.0

    # Run Docker container
    docker run -d -p 8000:8000 `
        -e SCANNER_IP=192.168.2.23 `
        -e SCANNER_PORT=9100 `
        -e MQTT_BROKER=192.168.2.23 `
        -e MQTT_PORT=1883 `
        -e MQTT_TOPIC=thetoplevel/codeit/scanner/scanner-service-container-1 `
        --name scanner-service-container-1 `
        scanner-service:1.0.0

    # Check running containers
    docker ps

    # Display container logs
    docker logs scanner-service-container-1
}

# Clean up function
function Clean-Up {
    # Stop the container
    docker stop scanner-service-container-1

    # Remove the container
    docker rm scanner-service-container-1

    # Optionally, remove the image (uncomment if needed)
    # docker rmi scanner-service:1.0.0
}

# Main execution
Write-Host "Select an operation:"
Write-Host "1: Git operations"
Write-Host "2: Docker operations"
Write-Host "3: Clean up Docker resources"
$choice = Read-Host "Enter your choice (1, 2, or 3)"

switch ($choice) {
    "1" { Git-Commands }
    "2" { Docker-Commands }
    "3" { Clean-Up }
    default { Write-Host "Invalid choice. Exiting." }
}